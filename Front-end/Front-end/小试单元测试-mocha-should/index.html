<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!--Description-->
    
            <meta name="description" content="something about me, something about everything.">
            

                <!--Author-->
                
                    <meta name="author" content="翁旺">
                    

                        <!--Open Graph Title-->
                        
                            <meta property="og:title" content="小试单元测试-mocha+should">
                            
                                    <!--Open Graph Description-->
                                    
                                            <meta property="og:description" content="something about me, something about everything.">
                                            
                                                <!--Open Graph Site Name-->
                                                <meta property="og:site_name" content="翁旺">
                                                <!--Type page-->
                                                
                                                    <meta property="og:type" content="article">
                                                    
                                                            <!--Page Cover-->
                                                            

                                                                        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

                                                                        <!-- Title -->
                                                                        
                                                                            <title>
                                                                                小试单元测试-mocha+should - 翁旺
                                                                            </title>


                                                                            <link rel="shortcut icon" href="https://oss.wengwang.me/images/ww_header.jpg">

                                                                            <!-- Custom CSS/Sass -->
                                                                            <link rel="stylesheet" href="/css/style.css">
                                                                                <!-- baidu_analytics start -->
                                                                                <script>
                                                                                    var _hmt = _hmt || [];
                                                                                    (function () {
                                                                                        var hm = document.createElement(
                                                                                            "script");
                                                                                        hm.src =
                                                                                            "https://hm.baidu.com/hm.js?61a517503c0b6fbcf3915c27c09b1e06";
                                                                                        var s = document.getElementsByTagName(
                                                                                            "script")[0];
                                                                                        s.parentNode.insertBefore(
                                                                                            hm, s);
                                                                                    })();
                                                                                </script>
                                                                                <!-- baidu_analytics end -->
</head>

<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://oss.wengwang.me/images/ww_header.jpg" alt="翁旺" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  Home
                
              </a>
            </li>
          
            <li>
              <a href="/daily">
                
                  Daily
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  Archive
                
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  About
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            小试单元测试-mocha+should
              
          </h1>
          <p class="posted-on">
            2017-07-09
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/Mocha/" rel="tag">
                  Mocha
                </a>
                
                <a href="/tags/Node.js/" rel="tag">
                  Node.js
                </a>
                
                <a href="/tags/UnitTest/" rel="tag">
                  UnitTest
                </a>
                
                  
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <p>github地址：<a href="https://github.com/a044161/pocket-tool" target="_blank" rel="noopener">https://github.com/a044161/pocket-tool</a>  </p>
<p>基于<a href="https://wengwang.me/Front-end/Front-end/记一次npm-package插件开发/">记一次npm package插件开发</a>写的。</p>
<h1><span id="kai-pian-xian-che">开篇闲扯</span></h1><p>很早就想把玩一下单元测试了，可是一直没找到机会使用，这次刚好兴致来了就简单的使用了，做一下小结，文章不会具体提到该如何使用，而是主要用来描述整个思路，因为各种<code>API</code>官方文档直接就能查到，所以没有啥意义。</p>
<a id="more"></a>
<h1><span id="wei-he-yao-jin-xing-dan-yuan-ce-shi">为何要进行单元测试</span></h1><p>每个人想要进行测试的目的都不同，可能大部分是为了想要验证某个函数最后的输出值是否正确，拥有较高的覆盖能够保证代码在后期的迭代过程中，增加或者删减某些功能时，可以通过之前写的测试用例进行验证，避免意外情况的发生。还有一种是先写好了结果，然后再进行开发，来保证代码符合预期。当然这都是我个人的一些理解。<br>回到我这次想要进行单元测试的目的，一种是可以了解单元测试，还有就是对我代码的可靠性进行验证。<br>选用的是<code>mocha</code>和<code>should</code>，为什么选择这两种呢，因为<code>mocha</code>足够上手快、功能全。<code>should</code>是因为这次测试中只需要用到<code>should</code>的就足够了。一直坚持的就是，不一定要选择大而全，而是要选择最适合的。</p>
<h1><span id="mu-lu-jie-gou">目录结构</span></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├─ core </span><br><span class="line">├─ dist</span><br><span class="line">├─ test // 单元测试</span><br><span class="line">│   │ </span><br><span class="line">│   ├─ utils // 因为core中有一个模块为utlis，因此这里存放的是utils相关的测试用例</span><br><span class="line">│   ├─ mocha.opts // mocha的配置文件</span><br><span class="line">│   └─ utils.test.js // utils的测试代码</span><br><span class="line">├─ .babelrc</span><br><span class="line">├─ index.js</span><br><span class="line">└─ rollup.config.js</span><br></pre></td></tr></table></figure>
<p>这里展示的目录只要<code>test</code>下的。<br>我是根据实际项目中，按照模块进行了拆分，这里只对<code>utils</code>模块进行了用例的编写。<br><code>utlis</code>下有根据想要进行单元测试的函数进行了拆分，以函数名进行命名，里面用来存放测试用例。<br><code>mocha.opts</code>是用来写<code>mocha</code>命令行的参数，我只写了一个 <code>--recursive</code> 表示执行当前文件夹下所有的测试，即文件名为<code>xx.test.js</code>的文件。<br><code>utils.test.js</code>则是用来写测试的脚本。</p>
<h1><span id="si-lu">思路</span></h1><p>先来看一下<code>utils.test.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">const should = require(&apos;should&apos;); // 引入should</span><br><span class="line">const Utils = require(&apos;../dist/pocket-tool&apos;).Utils; // 引入自己写的函数</span><br><span class="line"></span><br><span class="line">const utilsCase = require(&apos;./utils&apos;); // 引入测试用例</span><br><span class="line"></span><br><span class="line">// 这里做了一个队结果为boolean类型判断的封装，</span><br><span class="line">// target为值，expect为期望的结果</span><br><span class="line">function booleanFn(target, expect) &#123;</span><br><span class="line">	if (expect) &#123;</span><br><span class="line">		target.should.be.true(); // should的语法</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		target.should.be.false();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 这里是对运行测试用例做了一个封装</span><br><span class="line">// type 是函数的名称，itemCb，是将每个用例返回到it中</span><br><span class="line">function runTestFn(type, itemCb) &#123;</span><br><span class="line">	let testItemObj = utilsCase[type];</span><br><span class="line">	testItemObj.map(item =&gt; &#123;</span><br><span class="line">		itemCb(item);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// it的第一个参数为名称，第二个参数是回调函数，测试的执行</span><br><span class="line">describe(&apos;undefined判断&apos;, () =&gt; &#123;</span><br><span class="line">	runTestFn(&apos;isUndefined&apos;, item =&gt; &#123;</span><br><span class="line">		it(`$&#123;item.name&#125;$&#123;item.expect ? &apos;为&apos; : &apos;不为&apos;&#125;undefined`, () =&gt; &#123;</span><br><span class="line">			booleanFn(Utils.isUndefined(item.value), item.expect);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">describe(&apos;null判断&apos;, () =&gt; &#123;</span><br><span class="line">	runTestFn(&apos;isNull&apos;, item =&gt; &#123;</span><br><span class="line">		it(`$&#123;item.name&#125;$&#123;item.expect ? &apos;为&apos; : &apos;不为&apos;&#125;null`, () =&gt; &#123;</span><br><span class="line">			booleanFn(Utils.isNull(item.value), item.expect);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">describe(&apos;合并对象&apos;, () =&gt; &#123;</span><br><span class="line">	runTestFn(&apos;merge&apos;, item =&gt; &#123;</span><br><span class="line">		it(item.name, () =&gt; &#123;</span><br><span class="line">			let mergeResult = Utils.merge(...item.value);</span><br><span class="line">			mergeResult.should.be.eql(item.expect);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>一开始我在写用例的时候发现很麻烦，如果有多个用例的话，那岂不是要写好多个<code>it</code>，就要重复多次，于是就有了上面提到的<code>utils</code>文件夹，里面用来存放测试用例的，现在就以<code>utils/isNull.js</code>和<code>utils/merge.js</code>为例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// utils/isNull.js</span><br><span class="line"></span><br><span class="line">module.exports = [</span><br><span class="line">	&#123;</span><br><span class="line">		value: null,</span><br><span class="line">		name: &apos;null&apos;,</span><br><span class="line">		expect: true</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		value: undefined,</span><br><span class="line">		name: &apos;Undefined&apos;,</span><br><span class="line">		expect: false</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		value: 1,</span><br><span class="line">		name: &apos;Number&apos;,</span><br><span class="line">		expect: false</span><br><span class="line">	&#125;,</span><br><span class="line">	...</span><br><span class="line">	,</span><br><span class="line">	&#123;</span><br><span class="line">		value: NaN,</span><br><span class="line">		name: &apos;NaN&apos;,</span><br><span class="line">		expect: false</span><br><span class="line">	&#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>该文件是用来存放判断是不是<code>Null</code>类型的用例，文件名称对应的就是函数名，其实就是一个数组，里面有多个对象，每个对象就是一个测试用例，其中<code>value</code>就是传入函数的值，<code>name</code>就是<code>it</code>的第一个参数，<code>expect</code>就是最终的期望结果。可以和<code>utils.test.js</code>对比来看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe(&apos;null判断&apos;, () =&gt; &#123;</span><br><span class="line">	runTestFn(&apos;isNull&apos;, item =&gt; &#123;</span><br><span class="line">		it(`$&#123;item.name&#125;$&#123;item.expect ? &apos;为&apos; : &apos;不为&apos;&#125;null`, () =&gt; &#123;</span><br><span class="line">			booleanFn(Utils.isNull(item.value), item.expect);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>参数是一一对应的，这样子我只要专注写用例就好，而且又易维护。</p>
<h1><span id="diao-yong-fang-shi">调用方式</span></h1><p>在<code>package.json</code>中增加一段脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">	&quot;build&quot;: &quot;rollup --config rollup.config.js&quot;,</span><br><span class="line">	&quot;test&quot;: &quot;npm run build &amp;&amp; mocha&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>直接<code>npm run test</code>就能看到结果了。</p>
<h1><span id="jie-yu">结语</span></h1><p>我可能才用到了一点点的功能，也许不是最佳的方式，但是对于一次的使用来说，添加用例的方式我还是用的比较舒服的，对于单元测试的各种实践，或者其中有说的不对的地方欢迎指出，可直接在<code>github</code>中进行交流。</p>

        </div>

        <div style="text-align:center;border-top: 1px solid #ccc;margin-top: 2em;">
          <p>下面是我的微信</p>
          <p>欢迎骚扰</p>
          <img width="250" src="https://oss.wengwang.me/images/ww_wechat_qrcode.jpg" alt="ww1o01">
          <!-- <p>当然你也可以选择分享</p>
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAAAAABQV18IAAACH0lEQVR42u2awY7DMAhE8/8/ne4x7Rrm0e5KGXd8SeWozrOEDQwcRzPOn3H9fR2rueu76/vX9a5z4xEoC6hqYfWB6oOv/6/W7TYUKH+olYFX8xVEd1BWm+nWD9S+UCvjJIavNhKo74WqjLQz3s5BB+p7oEgQV8VgnVF3MG9HCYG6PZRKHP7r+VE2E6jbQp1gdJdllyBUIPJ7gbKGUsE/uVw7EaQLGlvDD5Qt1NQRd4KFuii75OPpGShrKBrsq4OhklEibKDIM1C3h6KXYjevHHN1iConHqj9oKigT+eIuC8NPVA2UEq0b53moFBJxJFfiUOgLKHIAiqpVILYpGAUKH8o6lCxMxVivxI+DhUlBsoCigoYVNSgjRMtWKCsoabGSYLDdy7KMoEIlBUUFbWmQshEIFtmM4GyhSLJI22imAgbuFkiUHZQxNDpxUpEN1KUCpQ3FBVKlf2hEzUICgPlC/WJEK8AVBNqmegGyh6KOM+JUjIpbreJQ6C2gKqMlYgW00JTGSAGyhqKClmq8KMuVtLEE6h9oIjzpIWjaXKhmhQD5QlFCtsqKSUFydEmAmUP1QV7I0cKkgR1uALlDXWKgXY1EN1IUhsobyjimAnwJAElxaRAeUPR4J80dNHmQpk0BMoeihgtacxRQKhYFKjtoUrBFDTWTA9LoPaHIgEYDQwnjRSB8ocizadUOP2LyzhQ3lBUCVFNDjR5wBdooByhHnY752dwrlsbAAAAAElFTkSuQmCC" /> -->
        </div>

      </article>
    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
        <div class="nav-previous">
          <a href="/Front-end/Front-end/记一次五子棋开发/" rel="prev"><span class="meta-arraw meta-arraw-left"></span> Older Posts</a>
        </div>
        
          
            <div class="nav-next">
              <a href="/Front-end/Front-end/PostCSS、stylus与SCSS的技术选型/" rel="prev">
                Newer Posts <span class="meta-arraw meta-arraw-right"></span></a>
            </div>
            
    </div>

  </div>
</div>

  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          关于本站
        </h1>
        <div class="custom-widget-content">
          
            something about me, something about everything.
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          Contact
        </h1>
        <div class="widget-text">
          
                  
                    <a href="https://github.com/a044161" class="icon icon-github" target="_blank">
                      github
                    </a>
                    
                    <a href="http://weibo.com/wengwang" class="icon icon-weibo" target="_blank">
                      weibo
                    </a>
                    
                    <a href="mailto:wengwangjay@126.com" class="icon icon-mail" target="_blank">
                      mail
                    </a>
                    
                      
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          Search
        </h1>
        <div class="widget-text">
          <form onsubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>
      翁旺 &copy;
        2020
    </span>
    
      <span class="split">|</span>
      <span>
        Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank">Daily</a>
      </span>
      
  </p>
</footer>

  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>

</body>

</html>
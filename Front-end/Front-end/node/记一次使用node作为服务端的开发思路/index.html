<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!--Description-->
    
            <meta name="description" content="something about me, something about everything.">
            

                <!--Author-->
                
                    <meta name="author" content="翁旺">
                    

                        <!--Open Graph Title-->
                        
                            <meta property="og:title" content="记一次使用node作为服务端的开发思路">
                            
                                    <!--Open Graph Description-->
                                    
                                            <meta property="og:description" content="something about me, something about everything.">
                                            
                                                <!--Open Graph Site Name-->
                                                <meta property="og:site_name" content="翁旺">
                                                <!--Type page-->
                                                
                                                    <meta property="og:type" content="article">
                                                    
                                                            <!--Page Cover-->
                                                            

                                                                        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

                                                                        <!-- Title -->
                                                                        
                                                                            <title>
                                                                                记一次使用node作为服务端的开发思路 - 翁旺
                                                                            </title>


                                                                            <link rel="shortcut icon" href="https://oss.wengwang.me/images/ww_header.jpg">

                                                                            <!-- Custom CSS/Sass -->
                                                                            <link rel="stylesheet" href="/css/style.css">
                                                                                <!-- baidu_analytics start -->
                                                                                <script>
                                                                                    var _hmt = _hmt || [];
                                                                                    (function () {
                                                                                        var hm = document.createElement(
                                                                                            "script");
                                                                                        hm.src =
                                                                                            "https://hm.baidu.com/hm.js?61a517503c0b6fbcf3915c27c09b1e06";
                                                                                        var s = document.getElementsByTagName(
                                                                                            "script")[0];
                                                                                        s.parentNode.insertBefore(
                                                                                            hm, s);
                                                                                    })();
                                                                                </script>
                                                                                <!-- baidu_analytics end -->
</head>

<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://oss.wengwang.me/images/ww_header.jpg" alt="翁旺" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  Home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  Archive
                
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  About
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            记一次使用node作为服务端的开发思路
              
          </h1>
          <p class="posted-on">
            2016-08-28
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/NodeJs/" rel="tag">
                  NodeJs
                </a>
                
                  
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <h1><span id="kai-pian-xian-che">开篇闲扯</span></h1><p>距离上一次的技术博文已经好久了，之前一直写的是关于<code>react</code>的（虽然才写了三篇），这次就写一写最近在项目中用到<code>node</code>来做服务端的开发思路，用<code>node</code>做服务端的机会不多，毕设用过一次，之后就没有用过了。先打个预防针，这次的开发思路完全是我自己瞎掰扯的，主要目的和之前写<code>react</code>一样，想要做一次小结，以及想要换取更多的交流，来弥补自身的不足。一直都觉得，写博文比写代码要难得多，不仅要回顾代码，还要理清思路，还要将这些思路清晰的表达出来，确实是一件不简单的事，自己写代码容易，但是要教会别人，或者告诉别人要难很多。<br>好了，这次主要从以下几个方面来展开说一下：</p>
<a id="more"></a>
<ul>
<li>目录结构  </li>
<li>数据库规划  </li>
<li>路由规划  </li>
<li>日志   </li>
<li>环境变量    </li>
<li>简单的token  </li>
<li>简单的插件编写  </li>
<li>目录结构  <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">├─ README.md</span><br><span class="line">├─ server.js // 入口文件</span><br><span class="line">│  </span><br><span class="line">├─app // 主文件夹</span><br><span class="line">│  │  </span><br><span class="line">│  ├─libs // 各种插件</span><br><span class="line">│  │      </span><br><span class="line">│  ├─mongodb // mongoose相关文件</span><br><span class="line">│  │  │  </span><br><span class="line">│  │  ├─documents</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  └─schemas</span><br><span class="line">│  │          </span><br><span class="line">│  ├─route // 路由</span><br><span class="line">│  │      </span><br><span class="line">│  ├─static // 静态资源</span><br><span class="line">│  │  │  </span><br><span class="line">│  │  ├─fonts</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  ├─images</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  ├─libs</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  ├─scripts</span><br><span class="line">│  │  │      </span><br><span class="line">│  │  └─styles</span><br><span class="line">│  │          </span><br><span class="line">│  └─views // 模板文件</span><br><span class="line">│          </span><br><span class="line">├─config // 环境变量的配置文件</span><br><span class="line">│      </span><br><span class="line">└─log // 日志文件</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>目录结构相对来说还是比较简单的，也是通过不断的调整和更改命名方式来定义目录结构，能够涵盖我当前项目的一些需求，可能还有更多关于服务端需要调用的功能和配置我这里没有列举出来，本身也是因为上次毕业设计结束后，时隔这么久再次使用了一次，个人觉得相对毕业设计的目录结构，这次的这个方案会更加直白和分离一些。欢迎各位同学能够一起分享一下自己的目录结构，能够一起探讨一下。</p>
<h1><span id="shu-ju-ku-gui-hua">数据库规划</span></h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">├─mongodb // mongoose相关文件  </span><br><span class="line">    ├─documents      </span><br><span class="line">    └─schemas</span><br></pre></td></tr></table></figure>
<p>数据库选用的是<code>mongodb</code>调用的第三方库为<a href="http://www.nodeclass.com/api/mongoose.html" target="_blank" rel="noopener">mongoose</a>，根据<code>mongoose</code>的官方定义，一共分为三个部分<code>schemas &gt; models &gt; documents</code>因此在目录的规划上将<code>schemas models</code>合在了一次，之前是有将他们分为三个不同的目录来存放，一定意义上能够做到分离，但是也让调用的过程稍微繁琐了一点（这次并大型应用，因此对于数据库的操作相对来说并不是非常复杂，<code>schemas models</code>中的一些中间件也较少用到），按照这样的规划，因此<code>schemas</code>中的写法大致是这样<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`use stricts`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AdminScheams = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    password: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Admin = mongoose.Model(<span class="string">'Admin'</span>, AdminSchemas);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Admin;</span><br></pre></td></tr></table></figure></p>
<p><code>documents</code>中是为了对数据库进行增删查改的操作，根据实际的项目需求，对其进行相关的一些封装，这里可能要用到<code>Promise</code>，根据<code>mongoose</code>官方的建议是使用<code>mpormise</code>，在<code>documents</code>中调用之前定义好的<code>models</code>进行操作<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`use strict`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mPromise = <span class="built_in">require</span>(<span class="string">'mpromise'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Models */</span></span><br><span class="line"><span class="keyword">const</span> Admin = <span class="built_in">require</span>(<span class="string">'../schemas/Admin'</span>);</span><br><span class="line"></span><br><span class="line">exports.Get = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> promise = <span class="keyword">new</span> mPromise();</span><br><span class="line">    </span><br><span class="line">    Admin</span><br><span class="line">    .findById(id)</span><br><span class="line">    .exec(<span class="function">(<span class="params">err, admin</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            promise.resolve(err, &#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>: &#123;&#125;, <span class="attr">info</span>: err&#125;);        </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            promise.resolve(err, &#123;<span class="attr">flag</span>: <span class="literal">true</span>, <span class="attr">data</span>: admin, <span class="attr">info</span>:<span class="string">''</span>&#125;); </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过引入<code>models</code>，<code>exports</code>一个函数，之后可以对其进行扩展，最简单的就是增删查改的需求，使用<code>promise</code>让最后返回的是一个<code>promise</code>对象，可以调用<code>xx.then()</code>根据不同的业务需求，可以先将一些常规的操作进行封装，这样可以保证在路由部分的调用能够是一个最简单的数据返回的效果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// route.js</span></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Documents */</span></span><br><span class="line"><span class="keyword">const</span> Admin = <span class="built_in">require</span>(<span class="string">'../mongodb/documents/admin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, (req, res) =&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> id = req.query.id;</span><br><span class="line"></span><br><span class="line">    Admin</span><br><span class="line">    .Get(id)</span><br><span class="line">    .then( <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(data.flag)&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span>: <span class="literal">true</span>, <span class="attr">data</span>: data.data, <span class="attr">info</span>:<span class="string">""</span>&#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.json(&#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>: &#123;&#125;, <span class="attr">info</span>: <span class="string">"无法查到相对应的管理员"</span>&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>在路由里面的调用方式就如上所示，还算是比较简便的一种方式，当然还有更好的方式，希望能够和大家沟通后，不断的进行改进。</p>
<h1><span id="lu-you-gui-hua">路由规划</span></h1><p>路由的规划还是蛮重要的，划分的足够精细，才能让后期能够有一个较好的扩展性。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">├─route // 路由</span><br><span class="line">   ├─api.js</span><br><span class="line">   ├─api</span><br><span class="line">      ├─admin.js</span><br></pre></td></tr></table></figure></p>
<p>我的划分习惯是逐级划分，如果api下面还有其它级的路由就建一个文件来存放其它的子路由，以此类推，如果api的子路由下面还有其它的子路由，就继续创建文件夹来存放其它的子路由。<br>先来创建<code>app.js</code>下的子路由<code>admin.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/list'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;<span class="attr">flag</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure></p>
<p>之后我们再来写<code>api.js</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Use */</span></span><br><span class="line">router.use(bodyParser.json());</span><br><span class="line">router.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router */</span></span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">'api/admin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router Use */</span></span><br><span class="line">router.use(<span class="string">'/admin'</span>, admin);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>看编写的方式应该就能够比较容易理解，<code>api.js</code>里面有子路由，可以通过<code>router.use</code>进行调用，也是这样逐级进行调用，最后入口文件<code>server.js</code>的话可以这样来使用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router */</span></span><br><span class="line"><span class="keyword">const</span> api = <span class="built_in">require</span>(<span class="string">'route/api'</span>);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">'/api'</span>, api)</span><br></pre></td></tr></table></figure></p>
<p>路由划分的思路大致就是这样，应该还是比较好理解的，希望大家能够告诉我有更好的方式，或者我这样的方式有什么不妥的地方，希望也能够得到大家的指正。</p>
<h1><span id="ri-zhi">日志</span></h1><p>关于日志这一部分，我这次使用的是<code>log4js</code>，刚好看见<a href="http://weibo.com/chromeappsstore?refer_flag=1001030101_&amp;is_all=1" target="_blank" rel="noopener">寸志</a>在<a href="https://zhuanlan.zhihu.com/FrontendMagazine#!" target="_blank" rel="noopener">前端外刊</a>发表了一篇<a href="https://zhuanlan.zhihu.com/p/22110802?refer=FrontendMagazine" target="_blank" rel="noopener">Node.js 之 log4js 完全讲解</a>的文章，就刚好开了一下进行使用了，具体的使用方法大家可以直接通过链接进行查看，使用的方式还是蛮容易上手的，我为了能够方便管理，我在前面的<code>libs</code>里面添加了一个<code>logger.js</code>方便进行维护，代码大致如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Logger */</span></span><br><span class="line"><span class="keyword">const</span> log4js = <span class="built_in">require</span>(<span class="string">'log4js'</span>);</span><br><span class="line">log4js.configure(&#123;</span><br><span class="line">	appenders: [</span><br><span class="line">		&#123;</span><br><span class="line">			type: <span class="string">'DateFile'</span>,</span><br><span class="line">			filename: <span class="string">'./log/api/access/api_access.log'</span>, <span class="comment">// 输出的路径</span></span><br><span class="line">			pattern: <span class="string">'-yyyy-MM-dd.log'</span>, <span class="comment">// 命名方式</span></span><br><span class="line">			alwaysIncludePattern: <span class="literal">true</span>,</span><br><span class="line">			category: <span class="string">'api_access'</span></span><br><span class="line">		&#125;,</span><br><span class="line">		</span><br><span class="line">	],</span><br><span class="line">	levels: &#123;</span><br><span class="line">		<span class="string">'api_access'</span>: log4js.levels.INFO</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	apiAccess: log4js.connectLogger(log4js.getLogger(<span class="string">'api_access'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后在上面创建的<code>api.js</code>中调用的方式就是<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Libs */</span></span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">'../libs/logger'</span>); <span class="comment">// 引入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Logger */</span></span><br><span class="line">router.use(logger.apiAccess); <span class="comment">// 调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Use */</span></span><br><span class="line">router.use(bodyParser.json());</span><br><span class="line">router.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router */</span></span><br><span class="line"><span class="keyword">const</span> admin = <span class="built_in">require</span>(<span class="string">'api/admin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router Use */</span></span><br><span class="line">router.use(<span class="string">'/admin'</span>, admin);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure></p>
<p>感觉是一种比较简单粗暴的方式，不同的日志类型，也都可以在刚刚的<code>logger.js</code>中进行配置管理，在任意地方进行调用</p>
<h1><span id="huan-jing-bian-liang">环境变量</span></h1><p>这个其实想要说的就是改变<code>NODE_ENV</code>的值，在不同的开发环境下可能调用的参数不同，例如参见的开发模式<code>development</code>和<code>production</code>两种，有可能在这些不同的环境下，服务调用的接口不同，数据库地址不同等等一系列的配置文件，这个可以通过使用<a href="https://www.npmjs.com/package/config" target="_blank" rel="noopener">config</a>这个第三方插件来使用，因此在目录结构那节里面有一个<code>config</code>的文件，下面就是用来存放config的配置文件，更多高级的使用方式可以查看相对应的<a href="https://www.npmjs.com/package/config" target="_blank" rel="noopener">文档</a>，我在<code>config</code>下创建了两个文件，分别是<code>development.json</code>和<code>production.json</code>，当然如果还有更多的环境可以创建多个配置文件，两个文件的写法相同，只是里面可能某些的参数不同，我就拿其中一个举例吧<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"mongodb"</span>: &#123;</span><br><span class="line">		<span class="attr">"path"</span>: <span class="string">"mongodb://127.0.0.1/test"</span>,</span><br><span class="line">		<span class="attr">"name"</span>: <span class="string">"test"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"server"</span> : &#123;</span><br><span class="line">		<span class="attr">"port"</span>: <span class="number">3131</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这都是根据自己的需求进行定义，内容也就没什么好解释的了，其中只要注意一下要严格按照<code>json</code>的写法，要不然会导致无法解析。接下来我们再来看看该如何调用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongodbConf = config.get(<span class="string">'mongodb'</span>);</span><br></pre></td></tr></table></figure></p>
<p>调用方式也是非常简单，先引入<code>config</code>，再通过<code>get</code>来获取你想要的字段，之后就和访问对象一样了。</p>
<h1><span id="jian-dan-de-token">简单的token</span></h1><p>对应<code>token</code>的验证机制，大家可以自行去查找一下，资料还是非常多的，这里我简单的介绍一下相对应的用法是什么样的，<code>token</code>我使用的是<a href="https://www.npmjs.com/package/jwt-simple" target="_blank" rel="noopener">jwt-simple</a>，和名字一样，使用的方式也是比较简单的，下面还是用相对应的代码来展示一下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'jwt-simple'</span>);</span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">'moment'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* MongoDB Models */</span></span><br><span class="line"><span class="keyword">const</span> Admin = <span class="built_in">require</span>(<span class="string">'../mongodb/schemas/admin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Set */</span></span><br><span class="line"><span class="keyword">const</span> jwtSecret =  <span class="string">'abcd1234'</span> <span class="comment">// token 秘钥</span></span><br><span class="line"></span><br><span class="line">exports.SetToken = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> expires = moment().add(<span class="number">7</span>, <span class="string">'days'</span>).valueOf();</span><br><span class="line">	<span class="keyword">const</span> token = jwt.encode(&#123;</span><br><span class="line">		iss: value, <span class="comment">// 加密对象</span></span><br><span class="line">		exp: expires <span class="comment">// 时间戳</span></span><br><span class="line">	&#125;, jwtSecret) <span class="comment">// 密钥</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.GetToken = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> reqToken = req.headers[<span class="string">"token"</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">typeof</span> reqToken !== <span class="string">'undefined'</span>)&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">const</span> decodedToken = jwt.decode(reqToken, jwtSecret);</span><br><span class="line">			<span class="keyword">if</span>(decodedToken.exp &lt;= <span class="built_in">Date</span>.now())&#123;</span><br><span class="line">				res.status(<span class="number">401</span>).json(&#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;, <span class="attr">info</span>:<span class="string">'token过期'</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				Admin</span><br><span class="line">				.findOne(&#123;<span class="attr">name</span>: decodedToken.iss&#125;)</span><br><span class="line">				.exec(<span class="function">(<span class="params">err, admin</span>) =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">if</span>(!admin)&#123;</span><br><span class="line">	res.status(<span class="number">403</span>).json(&#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;, <span class="attr">info</span>:<span class="string">'无操作权限'</span>);</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						next()</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">			res.status(<span class="number">403</span>).json(&#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;, <span class="attr">info</span>:<span class="string">'无操作权限'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		res.status(<span class="number">403</span>).json(&#123;<span class="attr">flag</span>: <span class="literal">false</span>, <span class="attr">data</span>:&#123;&#125;, <span class="attr">info</span>:<span class="string">'无操作权限'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>先引入<code>jwt-simple</code>，再定义一个秘钥<code>jwtSecret</code>，我还使用了多定义了两个方法以便后面进行调用，一个是<code>SetToken</code>设置<code>token</code>还有一个就是<code>GetToken</code>获取<code>token</code>，其实相对应的就是<code>encode</code>和<code>decode</code>，首先是想对想要进行加密的部分进行<code>encode</code>当然<code>{iss: value, exp: expires}</code>这个是可以自定义的。之后再根据客户端发送的<code>token</code>进行<code>decode</code>，来获取相对应的信息，在上面的代码中我是先对时间进行验证，再根据之前加密的<code>name</code>进行数据库查询，如果有相对应的值，则允许进入下一个路由。<br>我将这个验证方式写到了<code>libs</code>，命名为<code>token.js</code>，在需要进行验证的地方可以进行调用<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Libs */</span></span><br><span class="line"><span class="keyword">const</span> token = <span class="built_in">require</span>(<span class="string">'../../libs/token'</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/list'</span>, token, (req, res) =&gt; &#123; <span class="comment">// 中间件的方式使用token</span></span><br><span class="line">    res.json(&#123;<span class="attr">flag</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router</span><br></pre></td></tr></table></figure></p>
<p>在需要进行<code>token</code>验证的路由下加入就好。</p>
<h1><span id="jian-dan-de-cha-jian-bian-xie">简单的插件编写</span></h1><p>在不断的开发过程中，会抽象出很多简单的小插件，主要目的就是为了方便后期重复代码的编写，以及解决一些数据上的处理，就像上面我抽象了两个出来，分别是日志的<code>logger.js</code>和<code>token</code>验证的<code>token.js</code>，其实后来发现，应该将<code>token.js</code>纳入<code>middleware</code>这个文件下。<br>其实我还多加一个<code>response.js</code>用来处理各个路由的<code>response</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line">exports.successRes = <span class="function">(<span class="params">res, data, info, status</span>) =&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> _status = status ? status : <span class="number">200</span>;</span><br><span class="line">	<span class="keyword">const</span> _info = info ? info : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> resData = &#123;</span><br><span class="line">		flag: <span class="literal">true</span>,</span><br><span class="line">		data: data,</span><br><span class="line">		info: _info,</span><br><span class="line">		status: _status</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res.status(_status).json(resData)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports.badRes = <span class="function">(<span class="params">res, info, status, data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> _status = status ? status : <span class="number">200</span>;</span><br><span class="line">	<span class="keyword">const</span> _info = info ? info : <span class="string">''</span>;</span><br><span class="line">	<span class="keyword">const</span> _data = data ? data : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> resData = &#123;</span><br><span class="line">		flag: <span class="literal">false</span>,</span><br><span class="line">		data: _data,</span><br><span class="line">		info: _info,</span><br><span class="line">		status: _status</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	res.status(_status).json(resData)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>一个为成功时的操作，一个为失败时的操作，这样做的好处是能够统一返回的格式，而且也较好进行统一的管理。其实很多都是开发过程中不断的进行抽象，不断的累积出适合实际业务的一套方案。<br>在最后就把入口文件<code>server.js</code>展示一下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Config */</span></span><br><span class="line"><span class="keyword">const</span> mongodbConfig = config.get(<span class="string">'mongodb'</span>);</span><br><span class="line"><span class="keyword">const</span> serverConfig = config.get(<span class="string">'server'</span>);</span><br><span class="line"></span><br><span class="line">process.on(<span class="string">'uncaughtException'</span>, (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Set */</span></span><br><span class="line">app.set(<span class="string">'views'</span>, <span class="string">'./app/views/'</span>); <span class="comment">// 页面路径</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'pug'</span>); <span class="comment">// 模板引擎</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 静态资源 */</span></span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'./app/static'</span>))); <span class="comment">//定义静态资源目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* connect mongodb */</span></span><br><span class="line">mongoose.connect(mongodbConfig.path);</span><br><span class="line"><span class="keyword">const</span> db = mongoose.createConnection(<span class="string">'localhost'</span>, mongodbConfig.name);</span><br><span class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error:'</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Use */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tmp */</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>); <span class="comment">// 解决跨域</span></span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router */</span></span><br><span class="line"><span class="keyword">const</span> api = <span class="built_in">require</span>(<span class="string">'./app/route/api'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Router use */</span></span><br><span class="line">app.use(<span class="string">'/api'</span>, api); <span class="comment">// api</span></span><br><span class="line"></span><br><span class="line">app.listen(serverConfig.port);</span><br></pre></td></tr></table></figure></p>
<h1><span id="jie-yu">结语</span></h1><p>发现距离写上一篇博文已经间隔了4个月，这一段时间内也发生了不少的事情，恩，在这篇博文里还是不适宜提起这些事情，还是以技术为主吧。<br>最主要的目的还是对这一次的使用过程做一次总结，想要和更多的人进行探讨，有任何问题或者任何想要交流的地方都可以和我联系，邮箱:wengwangjay@126.com，微博:@爱拍照的小胖纸。</p>

        </div>

        <div style="text-align:center;border-top: 1px solid #ccc;margin-top: 2em;">
          <p>下面是我的微信</p>
          <p>欢迎骚扰</p>
          <img width="250" src="https://oss.wengwang.me/images/ww_wechat_qrcode.jpg" alt="ww1o01">
          <!-- <p>当然你也可以选择分享</p>
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACkCAAAAAA83tqdAAAChklEQVR42u2cwW7DMAxD+/8/ne2yHVZJfHKGAQvpS9ulcV6KWKYkYq/XMK7P8fX68313jM5TzXU0AvlIyKsY1aTTORVUBV4dq36At3kDaQfZPejdydU51SLq5prOKbkCGcgm2E6Bd1pEJ5tBIANJhEUVkCvw7gZVMA9kIJXA6ATsdvHQDeBIBQXycZAkEfuL19vZYiAfAXmBocQGEcQnovp7rkBaQRKRSwpSKgmbxAoSwYG0gTwJsCdChHxuCwmBtIScLiYDLbg4+THajSCQVpBq098+7N0xVewn1w+kD6QSpepBpwJjUxRoRUYgHw+pCphHjaEhSKtmQfk+kFaQqmhPmvanQkM1p96KA4G0gFRJOzEgbUwh1GTyFswDaQe5NX9sRCw10Y0VtUBaQZKIPwV7ErzVDzIu0EBaQqoHfTKQbJtR2wZsIL0gu0mmC1xwkGIDNvAF0g5yMr2pQsBvmZfGvwfSBlIJAfrgb4xKtGgbSE/I6Yt0YU3JFzE0KQEcSC9IkqirROnEvESuVVbVAmkBuWnGS3feotk0CeOxARrIR0OqZpAqzG9MJaTIOm4ugbSBnIKtSv6VWZmIYnSzgbSBnBJzVXSSjUuwiNB3AmkFuRnEuEQaAaO773Xzv98E8t9D0iB+xzCijFCy8R9IK0gSZElivw3YW4NdIH0gN40gIjLUsa0hNJB+kNNFThI0JYSpaSSQvpDU7EGEwzZhw7tNIK0gaeI1Jf0nimbTyA+kHyQpkKpiqQImwmQsdgXSDlItGAJAQJU4bkVvIAO5XAQnRlElZmQHIpCWkBR2s1DI+agrFshHQ1KBsSnUnxRe25sNpBWkSsQ2xSZqliOCZJUtBvIpkB8gxX9OWNx9ggAAAABJRU5ErkJggg==" /> -->
        </div>

      </article>
    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
        <div class="nav-previous">
          <a href="/Talk/Talk/meeting/2016-JSConf-小感/" rel="prev"><span class="meta-arraw meta-arraw-left"></span> Older Posts</a>
        </div>
        
          
            <div class="nav-next">
              <a href="/Travel/Travel/chengdu/毕业了！黄龙-九寨沟-若尔盖-成都/" rel="prev">
                Newer Posts <span class="meta-arraw meta-arraw-right"></span></a>
            </div>
            
    </div>

  </div>
</div>

  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          关于本站
        </h1>
        <div class="custom-widget-content">
          
            something about me, something about everything.
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          Contact
        </h1>
        <div class="widget-text">
          
                  
                    <a href="https://github.com/a044161" class="icon icon-github" target="_blank">
                      github
                    </a>
                    
                    <a href="http://weibo.com/wengwang" class="icon icon-weibo" target="_blank">
                      weibo
                    </a>
                    
                    <a href="mailto:wengwangjay@126.com" class="icon icon-mail" target="_blank">
                      mail
                    </a>
                    
                      
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">
          Search
        </h1>
        <div class="widget-text">
          <form onsubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>
      翁旺 &copy;
        2020
    </span>
    
      <span class="split">|</span>
      <span>
        Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank">Daily</a>
      </span>
      
  </p>
</footer>

  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>

</body>

</html>